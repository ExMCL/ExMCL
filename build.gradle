group 'ExMCL'

apply plugin: 'java'

sourceCompatibility = 1.5

repositories {
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.11'
}

/*http://www.tikalk.com/devops/increment-version-numbers-in-gradle/*/
task buildnumberplusone {
    Properties props = new Properties()
    File propsFile = new File('gradle.properties')
    props.load(propsFile.newDataInputStream())
    Integer nextbuildnum = ( ((props.getProperty('artifactBuildNumber')) as BigDecimal) + 1 )
    props.setProperty('artifactBuildNumber', nextbuildnum.toString())
    props.store(propsFile.newWriter(), null)
    props.load(propsFile.newDataInputStream())
    System.out.println("Build Number: $artifactBuildNumber")
}

task generateVersion {
    File outputFile = new File("ExMCL API/src/main/kotlin/com/n9mtq4/exmcl/api/Version.kt")
    PrintWriter writer = new PrintWriter(outputFile)
    writer.println("/*AUTO GENERATED FILE*/")
    writer.println("@file:JvmName(\"Version\")")
    writer.println("package com.n9mtq4.exmcl.api")
    writer.println("const val BUILD_NUMBER = $artifactBuildNumber")
    writer.close()
    System.out.println("Generated Version File")
}

build.dependsOn buildnumberplusone
build.dependsOn generateVersion
